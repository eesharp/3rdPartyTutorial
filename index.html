<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="description" content="3rdpartytutorial : This is a tutorial that shows how to create communication between a third party service and a database.">

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>3rdpartytutorial</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/eesharp/3rdPartyTutorial">View on GitHub</a>

          <h1 id="project_title">3rdpartytutorial</h1>
          <h2 id="project_tagline">This is a tutorial that shows how to create communication between a third party service and a database.</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/eesharp/3rdPartyTutorial/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/eesharp/3rdPartyTutorial/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<a id="implement-facebook-login-on-your-website" class="anchor" href="#implement-facebook-login-on-your-website" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>Implement Facebook Login on Your Website</h1>

<p><em>This is a tutorial that shows how to create communication between a third party service and a database</em></p>

<h3>
<a id="what-you-need" class="anchor" href="#what-you-need" aria-hidden="true"><span aria-hidden="true" class="octicon octicon-link"></span></a>What you need:</h3>

<ol>
<li>
<p>PHP version 5.4 or greater</p>

<blockquote>
<p>To check what version of php you have, you can go into the public folder of your slim application, and create a file in
zero-to-slim.dev -&gt; public folder called test.php with the following code:</p>

<pre><code>    &lt;?php
      echo phpversion();
    ?&gt;
</code></pre>

<p>Save, and then go to zero-to-slim.dev/test.php and it will tell you what version you have</p>
</blockquote>
</li>
<li>
<p>Have PHP mbstring Enabled</p>

<blockquote>
<p>To check that you have this enabled run the following and it should be listed</p>

<pre><code>   php -m 
</code></pre>
</blockquote>
</li>
</ol>

<p>After you have met the basic requirements, you need to register your app with Facebook. To do this, go to <code>developers.facebook.com</code>
and log in. </p>

<p>Once you are logged in, you will have a menu called <strong>My Apps</strong>. Click that and create a new app.</p>

<p><img src="https://cloud.githubusercontent.com/assets/17342721/13798818/cb064408-eae7-11e5-8eb2-0575f2d1786d.png" alt="pic1"></p>

<p>In this tutorial we will be creating a web application. When prompted, choose the website option and create a name for your app. For the app category you can choose whatever you want.</p>

<p><img src="https://cloud.githubusercontent.com/assets/17342721/13798822/cd2fc4e8-eae7-11e5-8a19-29e86f43ad3e.png" alt="pic2"></p>

<p>Click <strong>create App ID</strong>. Once you have done that, click <strong>My Apps</strong> again and choose your app from the menu. You will be taken to a dashboard that shows you your app ID, version, and app secret (digital certificate). You will need these for later. For now, click on <strong>settings</strong> in the left menu bar.</p>

<p><img src="https://cloud.githubusercontent.com/assets/17342721/13798823/ce46fbd0-eae7-11e5-9f70-30919903c220.png" alt="pic3"></p>

<p>You should see this:</p>

<p><img src="https://cloud.githubusercontent.com/assets/17342721/13798826/cf79f23c-eae7-11e5-80a1-35809fd74113.png" alt="pic4"></p>

<p>Under <code>App Domains</code>, type in the URL of your website and click <strong>Add Platform</strong>. Insert the same URL and click save changes.</p>

<p><img src="https://cloud.githubusercontent.com/assets/17342721/13798827/d0638a14-eae7-11e5-8752-4e6ee4b5c083.png" alt="pic5"></p>

<p>The next step is to download the PHP SDK that Facebook provides. To do this, follow the next steps to manually install SDK for PHP.</p>

<p><img src="https://cloud.githubusercontent.com/assets/17342721/13798828/d150a632-eae7-11e5-9c6d-075cf5861ed3.png" alt="pic6"></p>

<p>After you unzip the file, it should look like this:</p>

<p><img src="https://cloud.githubusercontent.com/assets/17342721/13798829/d2450718-eae7-11e5-981f-f640b41d69ff.png" alt="pic7"></p>

<p>In your <code>zero-to-slim.dev/public</code> folder, I would recommend that you create a <code>fbtest</code> file</p>

<p><img src="https://cloud.githubusercontent.com/assets/17342721/13798830/d384756e-eae7-11e5-9359-df6e6e823fe9.png" alt="pic8"></p>

<p>Then copy the <code>src</code> folder from the facebook file you downloaded and paste it into the <code>fbtest</code> file.</p>

<p><img src="https://cloud.githubusercontent.com/assets/17342721/13798831/d48e4228-eae7-11e5-8eea-12da63d97171.png" alt="pic9"></p>

<p>In the same fbtest file, create a file called <code>index.php</code>. 
As for the code that goes in this file, copy and paste the following into your index.php file:</p>

<pre><code>&lt;?php
session_start();
require_once __DIR__ . '/src/Facebook/autoload.php';

$fb = new Facebook\Facebook([
  'app_id' =&gt; 'APP_ID',
  'app_secret' =&gt; 'APP_SECRET',
  'default_graph_version' =&gt; 'v2.4',
  ]);

$helper = $fb-&gt;getRedirectLoginHelper();

$permissions = ['email']; // optional

try {
    if (isset($_SESSION['facebook_access_token'])) {
        $accessToken = $_SESSION['facebook_access_token'];
    } else {
        $accessToken = $helper-&gt;getAccessToken();
    }
} catch(Facebook\Exceptions\FacebookResponseException $e) {
    // When Graph returns an error
    echo 'Graph returned an error: ' . $e-&gt;getMessage();

    exit;
} catch(Facebook\Exceptions\FacebookSDKException $e) {
    // When validation fails or other local issues
    echo 'Facebook SDK returned an error: ' . $e-&gt;getMessage();
    exit;
 }

if (isset($accessToken)) {
    if (isset($_SESSION['facebook_access_token'])) {
        $fb-&gt;setDefaultAccessToken($_SESSION['facebook_access_token']);
    } else {
        // getting short-lived access token
        $_SESSION['facebook_access_token'] = (string) $accessToken;

        // OAuth 2.0 client handler
        $oAuth2Client = $fb-&gt;getOAuth2Client();

        // Exchanges a short-lived access token for a long-lived one
        $longLivedAccessToken = $oAuth2Client-&gt;getLongLivedAccessToken($_SESSION['facebook_access_token']);

        $_SESSION['facebook_access_token'] = (string) $longLivedAccessToken;

        // setting default access token to be used in script
        $fb-&gt;setDefaultAccessToken($_SESSION['facebook_access_token']);
    }

    // redirect the user back to the same page if it has "code" GET variable
    if (isset($_GET['code'])) {
        header('Location: ./');
    }

    // getting basic info about user
    try {
        $profile_request = $fb-&gt;get('/me?fields=name,first_name,last_name,email');
        $profile = $profile_request-&gt;getGraphNode()-&gt;asArray();
    } catch(Facebook\Exceptions\FacebookResponseException $e) {
        // When Graph returns an error
        echo 'Graph returned an error: ' . $e-&gt;getMessage();
        session_destroy();
        // redirecting user back to app login page
        header("Location: ./");
        exit;
    } catch(Facebook\Exceptions\FacebookSDKException $e) {
        // When validation fails or other local issues
        echo 'Facebook SDK returned an error: ' . $e-&gt;getMessage();
        exit;
    }

    // printing $profile array on the screen which holds the basic info about user
    print_r($profile);

    // Now you can redirect to another page and use the access token from $_SESSION['facebook_access_token']
} else {
    // replace your website URL same as added in the developers.facebook.com/apps e.g. if you used http instead of https and you used non-www version or www version of your website then you must add the same here
    $loginUrl = $helper-&gt;getLoginUrl('https://sohaibilyas.com/fbapp/', $permissions);
    echo '&lt;a href="' . $loginUrl . '"&gt;Log in with Facebook!&lt;/a&gt;';
}
</code></pre>

<p>There are a couple of things you need to change in this file.</p>

<blockquote>
<p>First, at the top you need to enter your <strong>App ID</strong>, <strong>App Secret</strong>, and change the version to <strong>2.5</strong>.</p>
</blockquote>

<pre><code>&lt;?php
    session_start();
    require_once __DIR__ . '/src/Facebook/autoload.php';

    $fb = new Facebook\Facebook([
    'app_id' =&gt; 'APP_ID',
    'app_secret' =&gt; 'APP_SECRET',
    'default_graph_version' =&gt; 'v2.4',
     ]);
</code></pre>

<blockquote>
<p>Then, scroll down to the bottom. You will need to replace the url with your own website.</p>

<p>replace your website URL same as added in the <code>developers.facebook.com/apps</code> e.g. if you used <code>http</code> instead of <code>https</code> and you used <code>non-www</code> version or <code>www version</code> of your website, then you must add the same here:</p>
</blockquote>

<pre><code>$loginUrl = $helper-&gt;getLoginUrl('http://zero-to-slim.dev/fbtest/index.php', $permissions);
    echo '&lt;a href="' . $loginUrl . '"&gt;Log in with Facebook!&lt;/a&gt;';
    }
</code></pre>

<p>Now there is one last thing to do. You need to add the following to the <code>routes.php</code> file in your <code>zero-to-slim.dev</code> directory so that <code>/fbtest/</code> will automatically redirect to <code>/fbtest/index.php</code>.</p>

<pre><code>$app-&gt;get('/fbtest/', function ($request, $response, $args){
  $url = 'http://zero-to-slim.dev/fbtest/index.php';
  header('Location: index.php');
  exit();
});
</code></pre>

<p>Go to <code>http://zero-to-slim.dev/fbtest/index.php</code> and you will see a link allowing you to log into Facebook.</p>

<p><code>https://developers.facebook.com/docs/php/gettingstarted</code></p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">3rdpartytutorial maintained by <a href="https://github.com/eesharp">eesharp</a></p>
        <p>Published with <a href="https://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
