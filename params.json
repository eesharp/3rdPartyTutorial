{
  "name": "3rdpartytutorial",
  "tagline": "This is a tutorial that shows how to create communication between a third party service and a database.",
  "body": "# Implement Facebook Login on Your Website\r\n*This is a tutorial that shows how to create communication between a third party service and a database*\r\n\r\n \r\n###What you need:\r\n\r\n1. PHP version 5.4 or greater\r\n    >To check what version of php you have, you can go into the public folder of your slim application, and create a file in\r\n    >zero-to-slim.dev -> public folder called test.php with the following code:\r\n  ```\r\n      <?php\r\n        echo phpversion();\r\n      ?>\r\n  ```\r\n\r\n   >Save, and then go to zero-to-slim.dev/test.php and it will tell you what version you have\r\n   \r\n2. Have PHP mbstring Enabled\r\n    >To check that you have this enabled run the following and it should be listed\r\n  ```\r\n     php -m \r\n  ```\r\n  \r\n  \r\n  \r\n  \r\nAfter you have met the basic requirements, you need to register your app with Facebook. To do this, go to ```developers.facebook.com```\r\nand log in. \r\n\r\nOnce you are logged in, you will have a menu called **My Apps**. Click that and create a new app.\r\n\r\n\r\n\r\n \r\n![pic1](https://cloud.githubusercontent.com/assets/17342721/13798818/cb064408-eae7-11e5-8eb2-0575f2d1786d.png)\r\n\r\n \r\n \r\n\r\nIn this tutorial we will be creating a web application. When prompted, choose the website option and create a name for your app. For the app category you can choose whatever you want.\r\n\r\n \r\n \r\n \r\n![pic2](https://cloud.githubusercontent.com/assets/17342721/13798822/cd2fc4e8-eae7-11e5-8a19-29e86f43ad3e.png)\r\n \r\n \r\n \r\n\r\nClick **create App ID**. Once you have done that, click **My Apps** again and choose your app from the menu. You will be taken to a dashboard that shows you your app ID, version, and app secret (digital certificate). You will need these for later. For now, click on **settings** in the left menu bar.\r\n\r\n\r\n \r\n \r\n![pic3](https://cloud.githubusercontent.com/assets/17342721/13798823/ce46fbd0-eae7-11e5-9f70-30919903c220.png)\r\n\r\n\r\n \r\n\r\nYou should see this:\r\n\r\n\r\n \r\n \r\n![pic4](https://cloud.githubusercontent.com/assets/17342721/13798826/cf79f23c-eae7-11e5-80a1-35809fd74113.png)\r\n\r\n\r\n \r\n\r\nUnder ```App Domains```, type in the URL of your website and click **Add Platform**. Insert the same URL and click save changes.\r\n\r\n\r\n \r\n \r\n![pic5](https://cloud.githubusercontent.com/assets/17342721/13798827/d0638a14-eae7-11e5-8752-4e6ee4b5c083.png)\r\n\r\n\r\n \r\n\r\nThe next step is to download the PHP SDK that Facebook provides. To do this, follow the next steps to manually install SDK for PHP.\r\n\r\n\r\n \r\n \r\n![pic6](https://cloud.githubusercontent.com/assets/17342721/13798828/d150a632-eae7-11e5-9c6d-075cf5861ed3.png)\r\n\r\n\r\n \r\n\r\nAfter you unzip the file, it should look like this:\r\n\r\n\r\n \r\n \r\n![pic7](https://cloud.githubusercontent.com/assets/17342721/13798829/d2450718-eae7-11e5-981f-f640b41d69ff.png)\r\n\r\n\r\n \r\n\r\nIn your ```zero-to-slim.dev/public``` folder, I would recommend that you create a ```fbtest``` file\r\n\r\n\r\n \r\n \r\n![pic8](https://cloud.githubusercontent.com/assets/17342721/13798830/d384756e-eae7-11e5-9359-df6e6e823fe9.png)\r\n\r\n\r\n \r\n\r\nThen copy the ```src``` folder from the facebook file you downloaded and paste it into the ```fbtest``` file.\r\n\r\n\r\n \r\n \r\n![pic9](https://cloud.githubusercontent.com/assets/17342721/13798831/d48e4228-eae7-11e5-8eea-12da63d97171.png)\r\n\r\n\r\n \r\n\r\nIn the same fbtest file, create a file called ```index.php```. \r\nAs for the code that goes in this file, copy and paste the following into your index.php file:\r\n\r\n```\r\n<?php\r\nsession_start();\r\nrequire_once __DIR__ . '/src/Facebook/autoload.php';\r\n\r\n$fb = new Facebook\\Facebook([\r\n  'app_id' => 'APP_ID',\r\n  'app_secret' => 'APP_SECRET',\r\n  'default_graph_version' => 'v2.4',\r\n  ]);\r\n\r\n$helper = $fb->getRedirectLoginHelper();\r\n\r\n$permissions = ['email']; // optional\r\n\t\r\ntry {\r\n\tif (isset($_SESSION['facebook_access_token'])) {\r\n\t\t$accessToken = $_SESSION['facebook_access_token'];\r\n\t} else {\r\n  \t\t$accessToken = $helper->getAccessToken();\r\n\t}\r\n} catch(Facebook\\Exceptions\\FacebookResponseException $e) {\r\n \t// When Graph returns an error\r\n \techo 'Graph returned an error: ' . $e->getMessage();\r\n\r\n  \texit;\r\n} catch(Facebook\\Exceptions\\FacebookSDKException $e) {\r\n \t// When validation fails or other local issues\r\n\techo 'Facebook SDK returned an error: ' . $e->getMessage();\r\n  \texit;\r\n }\r\n\r\nif (isset($accessToken)) {\r\n\tif (isset($_SESSION['facebook_access_token'])) {\r\n\t\t$fb->setDefaultAccessToken($_SESSION['facebook_access_token']);\r\n\t} else {\r\n\t\t// getting short-lived access token\r\n\t\t$_SESSION['facebook_access_token'] = (string) $accessToken;\r\n\r\n\t  \t// OAuth 2.0 client handler\r\n\t\t$oAuth2Client = $fb->getOAuth2Client();\r\n\r\n\t\t// Exchanges a short-lived access token for a long-lived one\r\n\t\t$longLivedAccessToken = $oAuth2Client->getLongLivedAccessToken($_SESSION['facebook_access_token']);\r\n\r\n\t\t$_SESSION['facebook_access_token'] = (string) $longLivedAccessToken;\r\n\r\n\t\t// setting default access token to be used in script\r\n\t\t$fb->setDefaultAccessToken($_SESSION['facebook_access_token']);\r\n\t}\r\n\r\n\t// redirect the user back to the same page if it has \"code\" GET variable\r\n\tif (isset($_GET['code'])) {\r\n\t\theader('Location: ./');\r\n\t}\r\n\r\n\t// getting basic info about user\r\n\ttry {\r\n\t\t$profile_request = $fb->get('/me?fields=name,first_name,last_name,email');\r\n\t\t$profile = $profile_request->getGraphNode()->asArray();\r\n\t} catch(Facebook\\Exceptions\\FacebookResponseException $e) {\r\n\t\t// When Graph returns an error\r\n\t\techo 'Graph returned an error: ' . $e->getMessage();\r\n\t\tsession_destroy();\r\n\t\t// redirecting user back to app login page\r\n\t\theader(\"Location: ./\");\r\n\t\texit;\r\n\t} catch(Facebook\\Exceptions\\FacebookSDKException $e) {\r\n\t\t// When validation fails or other local issues\r\n\t\techo 'Facebook SDK returned an error: ' . $e->getMessage();\r\n\t\texit;\r\n\t}\r\n\t\r\n\t// printing $profile array on the screen which holds the basic info about user\r\n\tprint_r($profile);\r\n\r\n  \t// Now you can redirect to another page and use the access token from $_SESSION['facebook_access_token']\r\n} else {\r\n\t// replace your website URL same as added in the developers.facebook.com/apps e.g. if you used http instead of https and you used non-www version or www version of your website then you must add the same here\r\n\t$loginUrl = $helper->getLoginUrl('https://sohaibilyas.com/fbapp/', $permissions);\r\n\techo '<a href=\"' . $loginUrl . '\">Log in with Facebook!</a>';\r\n}\r\n```\r\n\r\nThere are a couple of things you need to change in this file.\r\n>First, at the top you need to enter your **App ID**, **App Secret**, and change the version to **2.5**.\r\n\r\n```\r\n<?php\r\n\tsession_start();\r\n\trequire_once __DIR__ . '/src/Facebook/autoload.php';\r\n\r\n\t$fb = new Facebook\\Facebook([\r\n  \t'app_id' => 'APP_ID',\r\n \t'app_secret' => 'APP_SECRET',\r\n  \t'default_graph_version' => 'v2.4',\r\n \t ]);\r\n```\r\n\r\n>Then, scroll down to the bottom. You will need to replace the url with your own website.\r\n\r\n>replace your website URL same as added in the ```developers.facebook.com/apps``` e.g. if you used ```http``` instead of ```https``` and you used ```non-www``` version or ```www version``` of your website, then you must add the same here:\r\n\r\n```\r\n$loginUrl = $helper->getLoginUrl('http://zero-to-slim.dev/fbtest/index.php', $permissions);\r\n    echo '<a href=\"' . $loginUrl . '\">Log in with Facebook!</a>';\r\n    }\r\n```\r\n\r\nNow there is one last thing to do. You need to add the following to the ```routes.php``` file in your ```zero-to-slim.dev``` directory so that ```/fbtest/``` will automatically redirect to ```/fbtest/index.php```.\r\n\r\n\r\n```\r\n$app->get('/fbtest/', function ($request, $response, $args){\r\n  $url = 'http://zero-to-slim.dev/fbtest/index.php';\r\n  header('Location: index.php');\r\n  exit();\r\n});\r\n```\r\n\r\nGo to ```http://zero-to-slim.dev/fbtest/index.php``` and you will see a link allowing you to log into Facebook.\r\n\r\n\r\n\r\n\r\n```https://developers.facebook.com/docs/php/gettingstarted                                                            ```\r\n\r\n",
  "google": "",
  "note": "Don't delete this file! It's used internally to help with page regeneration."
}